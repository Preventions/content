Move integration code to package, handleerrors and logs more gracefully